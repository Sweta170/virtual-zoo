{% extends 'zoo/base.html' %}
{% load dict_extras %}
{% block content %}
  <h2>Take a Quiz</h2>
  <p>Quizzes found: {{ quiz_count }}</p>
  {% if quizzes %}
    <form method="post">
      {% csrf_token %}
      {% for quiz in quizzes %}
        {% with quiz_result=results|dict_get:quiz.id %}
        <div class="mb-4">
          <h5>{{ quiz.question }}</h5>
          {% for option in quiz.options.splitlines %}
            <div class="form-check">
              <input class="form-check-input" type="radio" name="quiz_{{ quiz.id }}" value="{{ option }}" id="quiz_{{ quiz.id }}_{{ forloop.counter }}"
                {% if quiz_result and quiz_result.user_answer == option %}checked{% endif %}>
              <label class="form-check-label" for="quiz_{{ quiz.id }}_{{ forloop.counter }}">{{ option }}</label>
              {% if quiz_result and quiz_result.user_answer == option %}
                {% if quiz_result.is_correct %}
                  <span class="text-success">&#10004; Correct</span>
                {% else %}
                  <span class="text-danger">&#10008; Wrong</span>
                {% endif %}
              {% endif %}
            </div>
          {% endfor %}
          {% if quiz_result %}
            <div>
              <small>Your answer: <strong>{{ quiz_result.user_answer|default:'No answer' }}</strong></small><br>
              <small>Correct answer: <strong>{{ quiz_result.correct_answer }}</strong></small>
            </div>
          {% endif %}
        </div>
        {% endwith %}
      {% endfor %}
      <button class="btn btn-success">Submit Answers</button>
    </form>
    {% if feedback %}
      <div class="alert alert-info mt-4">
        You scored {{ feedback.score }} out of {{ feedback.total }}.
      </div>
    {% endif %}
  {% else %}
    <p>No quizzes available yet.</p>
  {% endif %}
{% endblock %}
