{% extends 'zoo/base.html' %}
{% load static %}
{% block content %}
  <div class="fade-in">
    <h2 class="dashboard-title animate__animated animate__fadeInDown">Dashboard</h2>
    <p class="mb-4">Your role: <strong>{{ role }}</strong></p>
    <div class="dashboard-row">
      <div class="card dashboard-card text-center animate__animated animate__zoomIn">
        <div class="card-body">
          <div class="dashboard-icon">ü¶Å</div>
          <h5 class="card-title">Animals</h5>
          <p class="dashboard-stat" id="dashboard-animals">0</p>
        </div>
      </div>
      <div class="card dashboard-card text-center animate__animated animate__zoomIn animate__delay-1s">
        <div class="card-body">
          <div class="dashboard-icon">üè∑Ô∏è</div>
          <h5 class="card-title">Categories</h5>
          <p class="dashboard-stat" id="dashboard-categories">0</p>
        </div>
      </div>
      <div class="card dashboard-card text-center animate__animated animate__zoomIn animate__delay-2s">
        <div class="card-body">
          <div class="dashboard-icon">üìç</div>
          <h5 class="card-title">Zones</h5>
          <p class="dashboard-stat" id="dashboard-zones">0</p>
        </div>
      </div>
      <div class="card dashboard-card text-center animate__animated animate__zoomIn animate__delay-3s">
        <div class="card-body">
          <div class="dashboard-icon">üìù</div>
          <h5 class="card-title">Blogs</h5>
          <p class="dashboard-stat" id="dashboard-blogs">0</p>
        </div>
      </div>
    </div>
    <div class="dashboard-cards-grid mb-4">
      <!-- Recently Added Animals -->
      <div class="dashboard-card dashboard-list-card animate__animated animate__fadeInUp">
        <div class="dashboard-section-title"><i class="bi bi-plus-circle-fill me-1"></i>Recently Added Animals</div>
        <div class="dashboard-list-modern">
          {% for animal in recent_animals %}
            <div class="dashboard-list-modern-item">
              {% if animal.image %}
                <img src="{{ animal.image.url }}" class="dashboard-animal-thumb" alt="{{ animal.name }}">
              {% else %}
                <img src="{% static 'zoo/no-image.png' %}" class="dashboard-animal-thumb" alt="No image">
              {% endif %}
              <div class="dashboard-list-modern-info">
                <div class="dashboard-animal-name">{{ animal.name }}</div>
                <div class="dashboard-animal-species">{{ animal.species }}</div>
                <div class="dashboard-animal-date">Added: {{ animal.created_at|date:"M d, Y" }}</div>
                <a href="{% url 'animal_detail' animal.pk %}" class="btn btn-sm btn-primary mt-1">View</a>
              </div>
            </div>
          {% empty %}
            <div class="text-muted">No recent animals.</div>
          {% endfor %}
        </div>
      </div>
      <!-- Most Viewed Animals -->
      <div class="dashboard-card dashboard-list-card animate__animated animate__fadeInUp animate__delay-1s">
        <div class="dashboard-section-title"><i class="bi bi-eye-fill me-1"></i>Most Viewed Animals</div>
        <div class="dashboard-list-modern">
          {% for animal in most_viewed_animals %}
            <div class="dashboard-list-modern-item">
              {% if animal.image %}
                <img src="{{ animal.image.url }}" class="dashboard-animal-thumb" alt="{{ animal.name }}">
              {% else %}
                <img src="{% static 'zoo/no-image.png' %}" class="dashboard-animal-thumb" alt="No image">
              {% endif %}
              <div class="dashboard-list-modern-info">
                <div class="dashboard-animal-name">{{ animal.name }}</div>
                <div class="dashboard-animal-species">{{ animal.species }}</div>
                <div class="dashboard-animal-date">Views: {{ animal.view_count }}</div>
                <a href="{% url 'animal_detail' animal.pk %}" class="btn btn-sm btn-outline-primary mt-1">View</a>
              </div>
            </div>
          {% empty %}
            <div class="text-muted">No data.</div>
          {% endfor %}
        </div>
      </div>
      <!-- Recent Blogs -->
      <div class="dashboard-card dashboard-list-card animate__animated animate__fadeInUp animate__delay-2s">
        <div class="dashboard-section-title"><i class="bi bi-journal-text me-1"></i>Recent Blogs</div>
        <div class="dashboard-list-modern">
          {% for blog in recent_blogs %}
            <div class="dashboard-list-modern-item">
              <div class="dashboard-blog-icon"><i class="bi bi-journal-text"></i></div>
              <div class="dashboard-list-modern-info">
                <div class="dashboard-blog-title">{{ blog.title }}</div>
                <div class="dashboard-blog-meta">by {{ blog.author.username }} &middot; {{ blog.date_posted|date:"M d, Y" }}</div>
                <a href="{% url 'blog_detail' blog.pk %}" class="btn btn-sm btn-outline-secondary mt-1">Read</a>
              </div>
            </div>
          {% empty %}
            <div class="text-muted">No recent blogs.</div>
          {% endfor %}
        </div>
      </div>
      <!-- Recent Feedback -->
      <div class="dashboard-card dashboard-list-card animate__animated animate__fadeInUp animate__delay-3s">
        <div class="dashboard-section-title"><i class="bi bi-chat-dots-fill me-1"></i>Recent Feedback</div>
        <div class="dashboard-list-modern">
          {% for feedback in recent_feedback %}
            <div class="dashboard-list-modern-item">
              <div class="dashboard-feedback-icon"><i class="bi bi-person-circle"></i></div>
              <div class="dashboard-list-modern-info">
                <div class="dashboard-feedback-user">{{ feedback.user.username|default:'Anonymous' }}</div>
                <div class="dashboard-feedback-message">{{ feedback.message|truncatewords:12 }}</div>
                <div class="dashboard-feedback-date">{{ feedback.created_at|date:"M d, Y H:i" }}</div>
              </div>
            </div>
          {% empty %}
            <div class="text-muted">No feedback yet.</div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <script>
    // Animated count-up for dashboard stats
    document.addEventListener('DOMContentLoaded', function() {
      function animateStat(id, end) {
        let el = document.getElementById(id);
        if (!el) return;
        let start = 0;
        let duration = 900;
        let step = Math.max(1, Math.ceil(end / 40));
        let current = start;
        let interval = setInterval(function() {
          current += step;
          if (current >= end) {
            el.textContent = end;
            clearInterval(interval);
          } else {
            el.textContent = current;
          }
        }, duration / (end || 1));
      }
      animateStat('dashboard-animals', Number('{{ animal_count }}'));
      animateStat('dashboard-categories', Number('{{ category_count }}'));
      animateStat('dashboard-zones', Number('{{ zone_count }}'));
      animateStat('dashboard-blogs', Number('{{ blog_count }}'));
    });
  </script>
{% endblock %}
