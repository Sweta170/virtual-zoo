{% extends 'zoo/base.html' %}
{% block content %}
  <div class="fade-in">
    <h2 class="dashboard-title animate__animated animate__fadeInDown">Dashboard</h2>
    <p class="mb-4">Your role: <strong>{{ role }}</strong></p>
    <div class="dashboard-row">
      <div class="card dashboard-card text-center animate__animated animate__zoomIn">
        <div class="card-body">
          <div class="dashboard-icon">ü¶Å</div>
          <h5 class="card-title">Animals</h5>
          <p class="dashboard-stat" id="dashboard-animals">0</p>
        </div>
      </div>
      <div class="card dashboard-card text-center animate__animated animate__zoomIn animate__delay-1s">
        <div class="card-body">
          <div class="dashboard-icon">üè∑Ô∏è</div>
          <h5 class="card-title">Categories</h5>
          <p class="dashboard-stat" id="dashboard-categories">0</p>
        </div>
      </div>
      <div class="card dashboard-card text-center animate__animated animate__zoomIn animate__delay-2s">
        <div class="card-body">
          <div class="dashboard-icon">üìç</div>
          <h5 class="card-title">Zones</h5>
          <p class="dashboard-stat" id="dashboard-zones">0</p>
        </div>
      </div>
      <div class="card dashboard-card text-center animate__animated animate__zoomIn animate__delay-3s">
        <div class="card-body">
          <div class="dashboard-icon">üìù</div>
          <h5 class="card-title">Blogs</h5>
          <p class="dashboard-stat" id="dashboard-blogs">0</p>
        </div>
      </div>
    </div>
    <div class="dashboard-cards-grid mb-4">
      <div class="dashboard-card dashboard-list-card">
        <div class="dashboard-section-title">Recently Added Animals</div>
        <ul class="dashboard-list">
          {% for animal in recent_animals %}
            <li><strong>{{ animal.name }}</strong> ({{ animal.species }})</li>
          {% empty %}
            <li>No recent animals.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="dashboard-card dashboard-list-card">
        <div class="dashboard-section-title">Most Viewed Animals</div>
        <ul class="dashboard-list">
          {% for animal in most_viewed_animals %}
            <li><strong>{{ animal.name }}</strong> ({{ animal.view_count }} views)</li>
          {% empty %}
            <li>No data.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="dashboard-card dashboard-list-card">
        <div class="dashboard-section-title">Recent Blogs</div>
        <ul class="dashboard-list">
          {% for blog in recent_blogs %}
            <li><strong>{{ blog.title }}</strong> by {{ blog.author.username }}</li>
          {% empty %}
            <li>No recent blogs.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="dashboard-card dashboard-list-card">
        <div class="dashboard-section-title">Recent Feedback</div>
        <ul class="dashboard-list">
          {% for feedback in recent_feedback %}
            <li><strong>{{ feedback.user.username|default:'Anonymous' }}</strong>: {{ feedback.message|truncatewords:12 }}</li>
          {% empty %}
            <li>No feedback yet.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  <script>
    // Animated count-up for dashboard stats
    document.addEventListener('DOMContentLoaded', function() {
      function animateStat(id, end) {
        let el = document.getElementById(id);
        if (!el) return;
        let start = 0;
        let duration = 900;
        let step = Math.max(1, Math.ceil(end / 40));
        let current = start;
        let interval = setInterval(function() {
          current += step;
          if (current >= end) {
            el.textContent = end;
            clearInterval(interval);
          } else {
            el.textContent = current;
          }
        }, duration / (end || 1));
      }
      animateStat('dashboard-animals', Number('{{ animal_count }}'));
      animateStat('dashboard-categories', Number('{{ category_count }}'));
      animateStat('dashboard-zones', Number('{{ zone_count }}'));
      animateStat('dashboard-blogs', Number('{{ blog_count }}'));
    });
  </script>
{% endblock %}
